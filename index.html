<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multi-Avatar Admin Dashboard - GitHub Live</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap');
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body { 
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f8f9fa;
            color: #1a1a1a;
        }
        
        .gradient-bg { background: linear-gradient(135deg, #ff006e, #8338ec, #00f2ea); }
        
        .card {
            background: white;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            transition: all 0.3s;
        }
        
        .card:hover {
            box-shadow: 0 8px 20px rgba(0,0,0,0.1);
            transform: translateY(-2px);
        }
        
        .stat-card {
            background: white;
            border-radius: 12px;
            padding: 24px;
            border-left: 4px solid;
        }
        
        .day-card {
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            overflow: hidden;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .day-card:hover {
            border-color: #8338ec;
            box-shadow: 0 8px 20px rgba(131, 56, 236, 0.15);
            transform: translateY(-2px);
        }
        
        .status-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .status-published { background: #d1fae5; color: #065f46; }
        .status-draft { background: #fef3c7; color: #92400e; }
        .status-scheduled { background: #dbeafe; color: #1e40af; }
        
        .status-live { background: #10b981; color: white; }
        .status-offline { background: #ef4444; color: white; }
        
        .btn {
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            border: none;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #ff006e, #8338ec);
            color: white;
        }
        
        .btn-primary:hover { opacity: 0.9; }
        
        .btn-secondary {
            background: white;
            color: #374151;
            border: 2px solid #e5e7eb;
        }
        
        .btn-secondary:hover { background: #f9fafb; }
        
        .btn-success {
            background: #10b981;
            color: white;
        }
        
        .btn-success:hover { background: #059669; }
        
        .hidden { display: none !important; }
        
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 50;
            padding: 2rem;
        }
        
        .modal-content {
            background: white;
            border-radius: 16px;
            max-width: 1000px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .workflow-section {
            background: #f9fafb;
            border-radius: 12px;
            padding: 20px;
            border: 2px solid #e5e7eb;
        }

        /* Image Upload Styles */
        .upload-area {
            border: 3px dashed #8338ec;
            border-radius: 15px;
            padding: 40px;
            text-align: center;
            background: #f8f9ff;
            margin: 20px 0;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .upload-area:hover {
            background: #f0f2ff;
            border-color: #ff006e;
        }

        .upload-area.dragover {
            background: #e8ebff;
            border-color: #8338ec;
            border-style: solid;
        }

        .upload-icon {
            font-size: 3em;
            margin-bottom: 10px;
        }

        input[type="file"] {
            display: none;
        }

        .file-preview {
            margin-top: 20px;
            padding: 20px;
            background: #f0f2ff;
            border-radius: 12px;
        }

        .file-preview img {
            max-width: 300px;
            max-height: 300px;
            border-radius: 12px;
            margin-top: 10px;
            border: 2px solid #e5e7eb;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .spinning {
            animation: spin 1s linear infinite;
        }

        .avatar-tab {
            padding: 12px 24px;
            border-radius: 10px;
            border: 2px solid #e5e7eb;
            background: white;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            font-size: 14px;
        }

        .avatar-tab:hover {
            border-color: #8338ec;
            background: #f8f9ff;
        }

        .avatar-tab.active {
            background: linear-gradient(135deg, #8338ec, #ff006e);
            color: white;
            border-color: transparent;
        }

        .avatar-tab.disabled {
            opacity: 0.5;
            cursor: not-allowed;
            background: #f5f5f5;
        }
    </style>
</head>
<body>
    <div id="app">
        <!-- Header -->
        <header class="gradient-bg shadow-lg">
            <div class="max-w-7xl mx-auto px-6 py-6">
                <div class="flex justify-between items-center flex-wrap gap-4">
                    <div>
                        <h1 class="text-3xl font-bold text-white">Multi-Avatar Admin Dashboard</h1>
                        <p class="text-white/90 mt-1">
                            Content Management & Workflow Dashboard
                            <span id="connection-status" class="status-badge status-live ml-2">üü¢ LIVE</span>
                        </p>
                    </div>
                    <div class="flex gap-3">
                        <button onclick="refreshAllData()" class="btn btn-secondary">
                            üîÑ Refresh Data
                        </button>
                        <button onclick="scrapeTikTok()" class="btn btn-success">
                            üîç Auto-Scrape TikTok
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <!-- Avatar Selector -->
        <section class="max-w-7xl mx-auto px-6 py-6">
            <div class="bg-white rounded-xl p-6 shadow-sm">
                <h2 class="text-xl font-bold mb-4">üë§ Select Avatar</h2>
                <div class="flex gap-3 flex-wrap">
                    <div class="avatar-tab active" onclick="switchAvatar('alyssa')">
                        üéØ Alyssa Harper - Career Coach
                    </div>
                    <div class="avatar-tab disabled" onclick="alert('Avatar 2 coming soon!')">
                        üìö Avatar 2 (Coming Soon)
                    </div>
                    <div class="avatar-tab disabled" onclick="alert('Avatar 3 coming soon!')">
                        üíº Avatar 3 (Coming Soon)
                    </div>
                </div>
            </div>
        </section>

        <!-- Stats Section -->
        <section class="max-w-7xl mx-auto px-6 py-6">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6" id="stats-container"></div>
        </section>

        <!-- Controls Section -->
        <section class="max-w-7xl mx-auto px-6 pb-6">
            <div class="bg-white rounded-xl p-6 shadow-sm">
                <div class="flex flex-wrap items-center justify-between gap-4">
                    <!-- View Selector -->
                    <div class="flex gap-2">
                        <button onclick="switchView('daily')" id="view-daily" class="btn btn-primary">
                            Daily View
                        </button>
                        <button onclick="switchView('weekly')" id="view-weekly" class="btn btn-secondary">
                            Weekly View
                        </button>
                        <button onclick="switchView('topic')" id="view-topic" class="btn btn-secondary">
                            By Topic
                        </button>
                    </div>
                    
                    <!-- Filters -->
                    <div class="flex gap-2">
                        <button onclick="filterContent('all')" id="filter-all" class="btn btn-primary text-sm">
                            All
                        </button>
                        <button onclick="filterContent('draft')" id="filter-draft" class="btn btn-secondary text-sm">
                            Draft
                        </button>
                        <button onclick="filterContent('published')" id="filter-published" class="btn btn-secondary text-sm">
                            Published
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Content Grid -->
        <section class="max-w-7xl mx-auto px-6 pb-12">
            <div id="content-container"></div>
        </section>

        <!-- Detail Modal -->
        <div id="detail-modal" class="hidden modal-overlay" onclick="closeModal(event)">
            <div class="modal-content" onclick="event.stopPropagation()">
                <div class="sticky top-0 bg-white border-b border-gray-200 p-6 flex justify-between items-start rounded-t-2xl z-10">
                    <div id="modal-header"></div>
                    <button onclick="closeModal()" class="text-gray-400 hover:text-gray-600 text-3xl leading-none">&times;</button>
                </div>
                <div class="p-6" id="modal-content"></div>
            </div>
        </div>
    </div>

    <script>
        // ============================================================================
        // AVATAR CONFIGURATIONS WITH GITHUB INTEGRATION
        // ============================================================================

        const avatars = {
            alyssa: {
                name: "Alyssa Harper",
                niche: "Career Coach",
                topics: ["Interview Prep", "Resume Tips", "Salary Negotiation", "Career Growth", "LinkedIn"],
                voiceId: "default",
                outputDir: "/Users/gregmansell/Desktop/heygen-demo/alyssa",
                
                // GitHub integration
                githubOwner: "alyssaharperhelps",
                githubRepo: "AyssaHarperHelps",
                githubBranch: "main",
                contentJsonPath: "data/content.json",
                
                get githubUrl() {
                    return `https://raw.githubusercontent.com/${this.githubOwner}/${this.githubRepo}/${this.githubBranch}/${this.contentJsonPath}`;
                },
                
                contentData: [],
                stats: {},
                lastUpdated: null,
                loading: false,
                error: null
            }
        };

        let currentAvatar = 'alyssa';
        let currentView = 'daily';
        let currentFilter = 'all';
        let uploadedImages = {}; // Store uploaded images per day

        // ============================================================================
        // GITHUB DATA FETCHING
        // ============================================================================

        async function loadContentFromGitHub(avatarKey) {
            const avatar = avatars[avatarKey];
            
            console.log(`üì° Fetching content for ${avatar.name}...`);
            avatar.loading = true;
            
            try {
                const response = await fetch(avatar.githubUrl + '?t=' + Date.now(), {
                    method: 'GET',
                    headers: { 'Accept': 'application/json', 'Cache-Control': 'no-cache' }
                });
                
                if (!response.ok) throw new Error(`GitHub fetch failed: ${response.status}`);
                
                const data = await response.json();
                avatar.contentData = data.content || [];
                avatar.stats = {
                    totalContent: data.totalContent || avatar.contentData.length,
                    published: data.published || 0,
                    drafts: data.drafts || 0,
                    totalViews: data.totalViews || 0
                };
                avatar.lastUpdated = data.lastUpdated;
                avatar.loading = false;
                
                console.log(`‚úÖ Loaded ${avatar.contentData.length} content cards`);
                
                updateConnectionStatus(true);
                renderStats();
                renderContent();
                
                return true;
                
            } catch (error) {
                console.error(`‚ùå Failed to load content:`, error);
                avatar.loading = false;
                avatar.error = error.message;
                
                // Use mock data for development
                avatar.contentData = generateMockContent();
                avatar.stats = { totalContent: 30, published: 18, drafts: 12, totalViews: 1300000 };
                
                updateConnectionStatus(false);
                renderStats();
                renderContent();
                
                return false;
            }
        }

        async function refreshAllData() {
            await loadContentFromGitHub(currentAvatar);
            alert('‚úÖ Data refreshed from GitHub!');
        }

        function updateConnectionStatus(isOnline) {
            const statusEl = document.getElementById('connection-status');
            if (statusEl) {
                statusEl.className = 'status-badge ' + (isOnline ? 'status-live' : 'status-offline') + ' ml-2';
                statusEl.textContent = isOnline ? 'üü¢ LIVE' : 'üî¥ OFFLINE';
            }
        }

        // ============================================================================
        // RENDERING FUNCTIONS
        // ============================================================================

        function renderStats() {
            const avatar = avatars[currentAvatar];
            const stats = avatar.stats;
            
            document.getElementById('stats-container').innerHTML = `
                <div class="stat-card" style="border-left-color: #8338ec;">
                    <div class="text-sm text-gray-500 mb-1">Total Content</div>
                    <div class="text-3xl font-bold">${stats.totalContent || 0}</div>
                </div>
                <div class="stat-card" style="border-left-color: #10b981;">
                    <div class="text-sm text-gray-500 mb-1">Published</div>
                    <div class="text-3xl font-bold">${stats.published || 0}</div>
                </div>
                <div class="stat-card" style="border-left-color: #f59e0b;">
                    <div class="text-sm text-gray-500 mb-1">Drafts</div>
                    <div class="text-3xl font-bold">${stats.drafts || 0}</div>
                </div>
                <div class="stat-card" style="border-left-color: #ef4444;">
                    <div class="text-sm text-gray-500 mb-1">Total Views</div>
                    <div class="text-3xl font-bold">${formatNumber(stats.totalViews || 0)}</div>
                </div>
            `;
        }

        function renderContent() {
            const avatar = avatars[currentAvatar];
            let filteredDays = avatar.contentData;
            
            if (currentFilter !== 'all') {
                filteredDays = avatar.contentData.filter(d => d.status === currentFilter);
            }

            let html = '';
            if (currentView === 'daily') {
                html = renderDailyView(filteredDays);
            } else if (currentView === 'weekly') {
                html = renderWeeklyView(filteredDays);
            } else {
                html = renderTopicView(filteredDays);
            }

            document.getElementById('content-container').innerHTML = html;
        }

        function renderDailyView(days) {
            if (days.length === 0) {
                return '<div class="text-center text-gray-500 py-12">No content available. Click "Auto-Scrape TikTok" to generate content.</div>';
            }
            
            return '<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">' + days.map(day => `
                <div class="day-card" onclick='showDetail(${day.day})'>
                    <div class="p-5">
                        <div class="flex justify-between items-start mb-3">
                            <div class="text-sm font-bold text-purple-600">DAY ${day.day}</div>
                            <span class="status-badge status-${day.status}">${day.status}</span>
                        </div>
                        <h3 class="font-bold text-lg mb-2">${day.title}</h3>
                        <div class="text-sm text-gray-500 mb-4">${day.category}</div>
                        <div class="grid grid-cols-2 gap-3 pt-3 border-t border-gray-100">
                            <div>
                                <div class="text-xs text-gray-500">Views</div>
                                <div class="font-semibold">${formatNumber(day.views || 0)}</div>
                            </div>
                            <div>
                                <div class="text-xs text-gray-500">Unlocks</div>
                                <div class="font-semibold">${formatNumber(day.unlocks || 0)}</div>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('') + '</div>';
        }

        function renderWeeklyView(days) {
            // Group by weeks
            const weeks = {};
            days.forEach(day => {
                const week = Math.ceil(day.day / 7);
                if (!weeks[week]) weeks[week] = [];
                weeks[week].push(day);
            });

            return '<div class="space-y-6">' + Object.entries(weeks).map(([week, weekDays]) => `
                <div class="card">
                    <h3 class="text-2xl font-bold mb-4 text-purple-600">Week ${week}</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                        ${weekDays.map(day => `
                            <div class="bg-gray-50 rounded-lg p-4 cursor-pointer hover:bg-gray-100" onclick='showDetail(${day.day})'>
                                <div class="text-sm text-gray-500">Day ${day.day}</div>
                                <div class="font-bold mt-1">${day.title}</div>
                                <div class="text-sm text-gray-600 mt-2">${formatNumber(day.views || 0)} views</div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `).join('') + '</div>';
        }

        function renderTopicView(days) {
            const topics = {};
            days.forEach(day => {
                if (!topics[day.category]) topics[day.category] = [];
                topics[day.category].push(day);
            });

            return '<div class="grid grid-cols-1 md:grid-cols-2 gap-6">' + Object.entries(topics).map(([topic, topicDays]) => `
                <div class="card">
                    <h3 class="text-2xl font-bold mb-4 text-purple-600">${topic}</h3>
                    <div class="space-y-3">
                        ${topicDays.map(day => `
                            <div class="bg-gray-50 rounded-lg p-4 cursor-pointer hover:bg-gray-100" onclick='showDetail(${day.day})'>
                                <div class="flex justify-between items-start">
                                    <div class="flex-1">
                                        <div class="text-sm text-gray-500">Day ${day.day}</div>
                                        <div class="font-bold mt-1">${day.title}</div>
                                    </div>
                                    <div class="text-sm text-gray-600 ml-4">${formatNumber(day.views || 0)}</div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `).join('') + '</div>';
        }

        // ============================================================================
        // DETAIL MODAL WITH IMAGE UPLOADER
        // ============================================================================

        function showDetail(dayNumber) {
            const avatar = avatars[currentAvatar];
            const day = avatar.contentData.find(d => d.day === dayNumber);
            if (!day) return;

            document.getElementById('modal-header').innerHTML = `
                <div>
                    <div class="text-sm text-gray-500 mb-1">Day ${day.day} ‚Ä¢ ${day.category}</div>
                    <h2 class="text-2xl font-bold">${day.title}</h2>
                </div>
            `;

            document.getElementById('modal-content').innerHTML = `
                <!-- Quick Info -->
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
                    <div class="bg-gray-50 rounded-lg p-4">
                        <div class="text-xs text-gray-500 mb-1">Password</div>
                        <div class="font-bold text-lg">${day.password || 'N/A'}</div>
                    </div>
                    <div class="bg-gray-50 rounded-lg p-4">
                        <div class="text-xs text-gray-500 mb-1">Views</div>
                        <div class="font-bold text-lg">${formatNumber(day.views || 0)}</div>
                    </div>
                    <div class="bg-gray-50 rounded-lg p-4">
                        <div class="text-xs text-gray-500 mb-1">Unlocks</div>
                        <div class="font-bold text-lg">${day.unlocks || 0}</div>
                    </div>
                    <div class="bg-gray-50 rounded-lg p-4">
                        <div class="text-xs text-gray-500 mb-1">Status</div>
                        <div class="font-bold text-lg capitalize">${day.status}</div>
                    </div>
                </div>

                <!-- Script -->
                <div class="mb-8">
                    <h3 class="text-lg font-bold mb-3">TikTok Script</h3>
                    <div class="bg-gray-50 rounded-lg p-4 text-gray-700 leading-relaxed whitespace-pre-wrap">${day.script}</div>
                </div>

                <!-- Key Points -->
                <div class="mb-8">
                    <h3 class="text-lg font-bold mb-3">Key Points</h3>
                    <ul class="space-y-2">
                        ${(day.keyPoints || []).map(point => `
                            <li class="flex items-start">
                                <span class="text-purple-500 mr-2 font-bold">‚Üí</span>
                                <span class="text-gray-700">${point}</span>
                            </li>
                        `).join('')}
                    </ul>
                </div>

                <!-- Image Prompts -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                    <div>
                        <h3 class="text-lg font-bold mb-3">Main Image Prompt</h3>
                        <div class="bg-gray-50 rounded-lg p-4 text-sm text-gray-700">${day.imagePrompt || 'No prompt available'}</div>
                        <button onclick="window.open('https://openart.ai', '_blank')" class="mt-3 text-purple-600 font-semibold hover:text-purple-700">
                            Open in OpenArt ‚Üí
                        </button>
                    </div>
                    <div>
                        <h3 class="text-lg font-bold mb-3">B-Roll Prompt</h3>
                        <div class="bg-gray-50 rounded-lg p-4 text-sm text-gray-700">${day.bRollPrompt || day.brollPrompt || 'No prompt available'}</div>
                        <button onclick="window.open('https://openart.ai', '_blank')" class="mt-3 text-purple-600 font-semibold hover:text-purple-700">
                            Open in OpenArt ‚Üí
                        </button>
                    </div>
                </div>

                <!-- IMAGE UPLOADER -->
                <div class="mb-8">
                    <h3 class="text-lg font-bold mb-3">üñºÔ∏è Seed Image for HeyGen</h3>
                    <p class="text-sm text-gray-600 mb-4">Upload a seed image that will be used to generate the talking avatar video</p>
                    
                    <div class="upload-area" id="upload-area-${day.day}" onclick="document.getElementById('image-input-${day.day}').click()">
                        <div class="upload-icon">üñºÔ∏è</div>
                        <div style="font-size: 1.1em; color: #666; margin-bottom: 10px;">
                            Click to upload or drag & drop seed image
                        </div>
                        <div style="color: #999; font-size: 0.9em;">
                            Supported: JPG, PNG (recommended: 1080x1080px)
                        </div>
                    </div>
                    
                    <input type="file" id="image-input-${day.day}" accept="image/jpeg,image/png,image/jpg" onchange="handleImageUpload(event, ${day.day})">
                    
                    <div class="file-preview hidden" id="image-preview-${day.day}">
                        <strong>‚úÖ Image loaded:</strong>
                        <div id="image-filename-${day.day}"></div>
                        <img id="preview-img-${day.day}" alt="Preview">
                    </div>
                </div>

                <!-- Workflow Actions Section -->
                <div class="workflow-section mb-8">
                    <h3 class="text-lg font-bold mb-4">üîÑ Workflow Actions</h3>
                    
                    <div class="space-y-3">
                        <!-- Step 1: Download Content -->
                        <div class="bg-white rounded-lg p-4">
                            <h4 class="font-semibold text-sm text-gray-700 mb-3">Step 1: Download Content</h4>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-2">
                                <button onclick="downloadPDF(${day.day}, '${day.title}')" class="btn btn-secondary text-sm">
                                    üì• Download PDF
                                </button>
                                <button onclick="downloadScript(${day.day}, '${day.title.replace(/'/g, "\\'")}')" class="btn btn-secondary text-sm">
                                    üìù Download Script (TXT)
                                </button>
                            </div>
                        </div>

                        <!-- Step 2: Generate Media -->
                        <div class="bg-white rounded-lg p-4">
                            <h4 class="font-semibold text-sm text-gray-700 mb-3">Step 2: Generate Media</h4>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-2">
                                <button onclick="generateAudio(${day.day}, '${day.title.replace(/'/g, "\\'")}')" class="btn btn-secondary text-sm">
                                    üéôÔ∏è Generate Audio (ElevenLabs)
                                </button>
                                <button onclick="generateVideo(${day.day}, '${day.title.replace(/'/g, "\\'")}')" class="btn btn-secondary text-sm" id="generate-video-btn-${day.day}">
                                    üé¨ Generate Video (HeyGen)
                                </button>
                            </div>
                            <div class="text-xs text-gray-500 mt-2">
                                üí° Audio saves to: /Users/gregmansell/Desktop/automation/11labs
                            </div>
                        </div>

                        <!-- Step 3: Publish -->
                        <div class="bg-white rounded-lg p-4">
                            <h4 class="font-semibold text-sm text-gray-700 mb-3">Step 3: Publish</h4>
                            <button onclick="approveAndPublish(${day.day}, '${day.title.replace(/'/g, "\\'")}')" class="btn btn-success w-full">
                                ‚úÖ Approve & Publish to TikTok
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Generated Files -->
                <div class="mb-8">
                    <h3 class="text-lg font-bold mb-3">Generated Files</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        ${day.files ? `
                            ${day.files.pdf ? `
                                <div class="bg-gray-50 rounded-lg p-4 flex items-center gap-3">
                                    <div class="text-3xl">üìÑ</div>
                                    <div class="flex-1">
                                        <div class="font-semibold text-sm">${day.files.pdf}</div>
                                        <div class="text-xs text-gray-500">PDF ‚Ä¢ 234 KB</div>
                                    </div>
                                </div>
                            ` : ''}
                            ${day.files.audio ? `
                                <div class="bg-gray-50 rounded-lg p-4 flex items-center gap-3">
                                    <div class="text-3xl">üéôÔ∏è</div>
                                    <div class="flex-1">
                                        <div class="font-semibold text-sm">${day.files.audio}</div>
                                        <div class="text-xs text-gray-500">MP3 ‚Ä¢ 1.2 MB</div>
                                    </div>
                                </div>
                            ` : ''}
                            ${day.files.video ? `
                                <div class="bg-gray-50 rounded-lg p-4 flex items-center gap-3">
                                    <div class="text-3xl">üé¨</div>
                                    <div class="flex-1">
                                        <div class="font-semibold text-sm">${day.files.video}</div>
                                        <div class="text-xs text-gray-500">MP4 ‚Ä¢ 45 MB</div>
                                    </div>
                                </div>
                            ` : ''}
                        ` : '<div class="text-gray-500 text-sm">No files generated yet</div>'}
                    </div>
                </div>
            `;

            // Set up drag and drop for this specific upload area
            setupImageUploader(day.day);

            document.getElementById('detail-modal').classList.remove('hidden');
        }

        // ============================================================================
        // IMAGE UPLOAD FUNCTIONALITY
        // ============================================================================

        function setupImageUploader(dayNumber) {
            const uploadArea = document.getElementById(`upload-area-${dayNumber}`);
            if (!uploadArea) return;

            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                e.stopPropagation();
                uploadArea.classList.add('dragover');
            });

            uploadArea.addEventListener('dragleave', (e) => {
                e.preventDefault();
                e.stopPropagation();
                uploadArea.classList.remove('dragover');
            });

            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                e.stopPropagation();
                uploadArea.classList.remove('dragover');
                const file = e.dataTransfer.files[0];
                if (file && file.type.startsWith('image/')) {
                    handleImageFile(file, dayNumber);
                }
            });
        }

        function handleImageUpload(event, dayNumber) {
            const file = event.target.files[0];
            if (file) {
                handleImageFile(file, dayNumber);
            }
        }

        function handleImageFile(file, dayNumber) {
            // Store the file
            uploadedImages[dayNumber] = file;
            
            // Show preview
            const preview = document.getElementById(`image-preview-${dayNumber}`);
            const fileName = document.getElementById(`image-filename-${dayNumber}`);
            const previewImg = document.getElementById(`preview-img-${dayNumber}`);

            fileName.textContent = `${file.name} (${(file.size / 1024 / 1024).toFixed(2)} MB)`;

            const reader = new FileReader();
            reader.onload = (e) => {
                previewImg.src = e.target.result;
            };
            reader.readAsDataURL(file);

            preview.classList.remove('hidden');
            
            console.log(`‚úÖ Image uploaded for Day ${dayNumber}:`, file.name);
        }

        // ============================================================================
        // WORKFLOW ACTION FUNCTIONS
        // ============================================================================

        function downloadPDF(day, title) {
            console.log(`Downloading PDF for Day ${day}: ${title}`);
            alert(`üì• Downloading PDF for Day ${day}\n\n${title}\n\nFile will be saved to:\n/Users/gregmansell/Desktop/automation/pdfs/`);
        }

        function downloadScript(day, title) {
            const avatar = avatars[currentAvatar];
            const dayData = avatar.contentData.find(d => d.day === day);
            
            if (!dayData) {
                alert('Script not found');
                return;
            }
            
            const content = `Day ${day}: ${title}\n${'='.repeat(50)}\n\n${dayData.script}`;
            
            const blob = new Blob([content], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `Day_${day}_${title.replace(/ /g, '_')}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            console.log(`‚úÖ Script downloaded for Day ${day}`);
        }

        function generateAudio(day, title) {
            console.log(`Generating Audio for Day ${day}: ${title}`);
            
            if (confirm(`üéôÔ∏è Generate Audio - Day ${day}\n\n${title}\n\nThis will:\n1. Use ElevenLabs API\n2. Convert script to audio\n3. Save to automation folder\n\nProceed?`)) {
                alert(`‚è≥ Generating audio...\n\nThis will take 10-30 seconds.\n\nCheck:\n/Users/gregmansell/Desktop/automation/11labs/\n\nFilename: Day_${day}_${title.replace(/ /g, '_')}.mp3`);
            }
        }

        function generateVideo(day, title) {
            console.log(`Generating Video for Day ${day}: ${title}`);
            
            // Check if image is uploaded
            if (!uploadedImages[day]) {
                alert('‚ö†Ô∏è Please upload a seed image first!\n\nScroll up and upload an image in the "Seed Image for HeyGen" section.');
                return;
            }
            
            const filename = `Day_${day}_${title.replace(/ /g, '_')}`;
            
            if (confirm(`üé¨ Generate Video - Day ${day}\n\n${title}\n\nUsing uploaded seed image: ${uploadedImages[day].name}\n\nThis will:\n1. Upload image and audio to HeyGen\n2. Generate talking avatar video\n3. Download to automation folder\n\nProcessing time: 2-5 minutes\n\nProceed?`)) {
                alert(`‚è≥ Video generation started!\n\n‚úÖ Using seed image: ${uploadedImages[day].name}\n\nProcessing time: 2-5 minutes\n\nVideo will be saved to:\n/Users/gregmansell/Desktop/automation/Alyssa/\n\nFilename: ${filename}.mp4`);
            }
        }

        function approveAndPublish(day, title) {
            console.log(`Approving and Publishing Day ${day}: ${title}`);
            
            if (confirm(`‚úÖ Approve & Publish - Day ${day}\n\n${title}\n\nThis will:\n1. Find video file\n2. Upload to TikTok\n3. Schedule for posting\n4. Update status to "published"\n\nProceed?`)) {
                alert(`üöÄ Publishing...\n\nContent will be scheduled!\n\nYou can monitor the status in your TikTok Creator dashboard.`);
            }
        }

        function scrapeTikTok() {
            const avatar = avatars[currentAvatar];
            const topics = avatar.topics.join(', ');
            
            if (confirm(`üîç Auto-Scrape TikTok\n\nAvatar: ${avatar.name}\nTopics: ${topics}\n\nThis will:\n1. Scrape trending TikTok videos\n2. Generate 30 days of content scripts\n3. Create image prompts\n4. Update content calendar\n\nEstimated time: 5-10 minutes\n\nProceed?`)) {
                alert(`‚úÖ Scraping started!\n\nProcessing...\n\nYou'll receive a notification when complete.`);
                // In production, this would trigger GitHub Actions workflow
            }
        }

        // ============================================================================
        // VIEW SWITCHING
        // ============================================================================

        function switchView(view) {
            currentView = view;
            
            ['daily', 'weekly', 'topic'].forEach(v => {
                const btn = document.getElementById(`view-${v}`);
                btn.className = v === view ? 'btn btn-primary' : 'btn btn-secondary';
            });
            
            renderContent();
        }

        function filterContent(filter) {
            currentFilter = filter;
            
            ['all', 'draft', 'published'].forEach(f => {
                const btn = document.getElementById(`filter-${f}`);
                btn.className = f === filter ? 'btn btn-primary text-sm' : 'btn btn-secondary text-sm';
            });
            
            renderContent();
        }

        function switchAvatar(avatarKey) {
            currentAvatar = avatarKey;
            
            document.querySelectorAll('.avatar-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');
            
            if (avatars[avatarKey].contentData.length === 0) {
                loadContentFromGitHub(avatarKey);
            } else {
                renderStats();
                renderContent();
            }
        }

        function closeModal(event) {
            if (!event || event.target.closest('.modal-content') === null) {
                document.getElementById('detail-modal').classList.add('hidden');
            }
        }

        function formatNumber(num) {
            if (num >= 1000000) return (num / 1000000).toFixed(1) + 'M';
            if (num >= 1000) return (num / 1000).toFixed(1) + 'K';
            return num.toString();
        }

        // ============================================================================
        // MOCK DATA FOR DEVELOPMENT
        // ============================================================================

        function generateMockContent() {
            return [
                {
                    day: 11,
                    title: "The 5-Question Interview Prep",
                    category: "Interview Prep",
                    password: "STARMETHOD",
                    views: 45000,
                    unlocks: 3200,
                    status: "published",
                    script: "Stop memorizing 100 behavioral questions. Master these 5 instead. By the end of this video, you'll have a framework that works for 90% of interviews...\n\nNumber 1: Tell me about yourself. Don't give your life story - focus on your last 3-5 years of relevant experience.\n\nNumber 2: Why this company? Show you've done research. Mention something specific about their culture or recent projects.\n\nNumber 3: Describe a challenge you've overcome. Use the STAR method: Situation, Task, Action, Result.\n\nNumber 4: Where do you see yourself in 5 years? Show ambition but stay realistic.\n\nNumber 5: Do you have any questions for us? ALWAYS ask thoughtful questions.",
                    keyPoints: [
                        "Master 5 core questions that cover 90% of interviews",
                        "Use the STAR method effectively",
                        "Adapt your stories to different question formats"
                    ],
                    imagePrompt: "Professional woman in business suit and glasses, confident expression",
                    bRollPrompt: "Office environment, interview setting, professional atmosphere",
                    files: {
                        pdf: "Day_11_The_5-Question_Interview_Prep.pdf",
                        audio: "Day_11_The_5-Question_Interview_Prep.mp3",
                        video: "Day_11_The_5-Question_Interview_Prep.mp4"
                    }
                },
                {
                    day: 12,
                    title: "Resume ATS Secrets",
                    category: "Resume Tips",
                    password: "ATSBEAT",
                    views: 38000,
                    unlocks: 2800,
                    status: "published",
                    script: "Your resume is getting rejected before a human sees it? Here's why...",
                    keyPoints: [
                        "Beat the ATS system",
                        "Include keywords",
                        "Use standard formats"
                    ],
                    imagePrompt: "Professional woman reviewing resume",
                    bRollPrompt: "Office desk with resume",
                    files: {
                        pdf: "Day_12_Resume_ATS_Secrets.pdf",
                        audio: "Day_12_Resume_ATS_Secrets.mp3"
                    }
                },
                {
                    day: 13,
                    title: "Salary Negotiation Framework",
                    category: "Salary Negotiation",
                    password: "NEVERACCEPT",
                    views: 0,
                    unlocks: 0,
                    status: "draft",
                    script: "Never accept the first offer. Here's my 3-step framework...",
                    keyPoints: [
                        "Never accept first offer",
                        "Research market rates",
                        "Counter with confidence"
                    ],
                    imagePrompt: "Professional woman in negotiation meeting",
                    bRollPrompt: "Corporate meeting room",
                    files: {}
                }
            ];
        }

        // ============================================================================
        // INITIALIZATION
        // ============================================================================

        document.addEventListener('DOMContentLoaded', () => {
            console.log('üöÄ Multi-Avatar Dashboard initialized');
            loadContentFromGitHub('alyssa');
            
            // Auto-refresh every 5 minutes
            setInterval(() => {
                loadContentFromGitHub(currentAvatar);
            }, 5 * 60 * 1000);
        });
    </script>
</body>
</html>
